<!DOCTYPE html>
<html lang="en">
    <head>
        <title> GFM's Gaming Arena </title>
        <meta charset="utf-8" name="viewport" content="width=1280, height=720, initial-scale=1" />
        <meta name="keywords" content="stream,skin" />
        <meta name="description" content="GFM's streaming skin" />
        <meta name="author" content="Gabriel Francisco Mandaji" />

        <style>
            @font-face {
                /** m5x7 by Daniel Linssen. Get it from https://managore.itch.io/m5x7. */
                font-family: "m5x7";
                src: url(/res/m5x7.ttf) format("truetype");
            }
            html, body {
                width: 1280px;
                height: 720px;
                margin: 0;
                padding: 0;
            }
            body {
                background-color: #222034;
                background-image: url('/img/bg.png');
                color: #cbdbfc;
                font-size: 1em;
            }
            img {
                /** Basic nearest-neighbour behaviour.
                 * Source: http://stackoverflow.com/questions/14068103/disable-antialising-when-scaling-images */
                image-rendering: optimizeSpeed;             /* STOP SMOOTHING, GIVE ME SPEED  */
                image-rendering: -moz-crisp-edges;          /* Firefox                        */
                image-rendering: -o-crisp-edges;            /* Opera                          */
                image-rendering: -webkit-optimize-contrast; /* Chrome (and eventually Safari) */
                image-rendering: pixelated;                 /* Chrome */
                image-rendering: optimize-contrast;         /* CSS3 Proposed                  */
                -ms-interpolation-mode: nearest-neighbor;   /* IE8+                           */
            }
            .m5x7 {
                font-family: "m5x7";
                font-size: 48px;
                display: block;
                overflow: hidden;
                word-break: break-all;
            }
            .centered {
                text-align: center;
            }
            .outlined {
                text-shadow: -1px -1px 0 #000,
                              1px -1px 0 #000,
                             -1px  1px 0 #000,
                              1px  1px 0 #000;  
            }
            .gameInfo {
                font-size: 24px;
                bottom: 0;
                right: 0;
            }
            .fixedRoot {
                /* Fixed position (unchanged by viewport size). Can be used as
                 * parent for other elements */
                position: fixed;
            }
            .fixedChild {
                /* Fixed position (unchanged by viewport size), but contained
                 * and relative to its closest parent. */
                position: absolute;
            }
            .darkBg {
                background-color: #000000;
                opacity: 0.75;
            }
            .gameDiv {
                outline: 2px solid #639bff;
                top: 8px;
            }
            .gameColorkey {
                background-color: #ff00ff;
                opacity: 1;
                outline: 4px solid #000000;
            }
            .line {
                background-color: #639bff;
                height: 2px;
                width: auto;
            }
        </style>

        <script type="text/javascript" src="/script/gamepad.js"></script>
        <script type="text/javascript" src="/script/utils.js"></script>
        <script>
            const gameViewInc = 1.1;
            const timerDivWidthInc = 1.1;
            const timerDivHeightInc = 1.05;
            const outlineWidth = 0.2;

            /**
             * Bootstrap, after the page is loaded
             */
            document.addEventListener("DOMContentLoaded", function (event) {
                setupGetLabelLength("m5x7 outlined");
                window.setTimeout(bootstrap, 100)
            })

            /**
             * Bootstrap, after the page is loaded
             */
            function bootstrap() {
                let args = null;
                let width = 0;
                let height = 0;
                let timerLength = 0;
                let titleLength = 0;
                let left = 0;
                let gameInfoTxt = "";
                let gameTitle = "Game Title";
                let timer = document.getElementById("timerDiv");
                let timerLabel = document.getElementById("timer");
                let timerLine1 = document.getElementById("timerLine1");
                let timerLine2 = document.getElementById("timerLine2");
                let gameView = document.getElementById("gameView");
                let gameColorkey = document.getElementById("gameColorkey");
                let gameInfo = document.getElementById("gameInfo");
                let title = document.getElementById("titleDiv");
                let titleLabel = document.getElementById("title");
                let titleLine1 = document.getElementById("titleLine1");
                let titleLine2 = document.getElementById("titleLine2");
                let gamepad = document.getElementById("gamepad-view");

                // Get the timer length and the arguments
                timerLength = getLabelLength(timerLabel.innerText);
                args = parseURL(window.location.href);

                // Parse the arguments
                if ("gameWidth" in args) {
                    width = parseInt(args.gameWidth);
                }
                if ("gameHeight" in args) {
                    height = parseInt(args.gameHeight);
                }
                if ("gameTitle" in args) {
                    gameTitle = args.gameTitle;
                }
                if ("nogamepad" in args) {
                    gamepad.style.visibility = "hidden";
                }
                else {
                    setupDefaultGamepad();
                }

                // Calculate the expected position
                left = Math.floor((document.body.offsetWidth - width*gameViewInc) * 0.5);
                if (left < timerLength) {
                    // Centralize the view considering (and possibly
                    // partially hiding) the timer.
                    left = Math.floor((document.body.offsetWidth - timerLength - width*gameViewInc) * 0.5);
                    left += timerLength;
                }

                // Make the outside box slightly bigger (5% bigger)
                gameView.style.width = Math.floor(width*gameViewInc)+"px";
                gameView.style.height = Math.floor(height*gameViewInc)+"px";
                gameView.style.left = left+"px";

                // Centralized, in viewport coordinates, the inner game view
                gameColorkey.style.width = width+"px";
                gameColorkey.style.height = height+"px";
                gameColorkey.style.left = Math.floor(left + (gameView.offsetWidth-width)*0.5)+"px";
                gameColorkey.style.top = Math.floor(gameView.offsetTop + (gameView.offsetHeight-height)*0.5)+"px";
                gameColorkey.style.outlineWidth = Math.floor((gameView.offsetWidth-width)*0.5*outlineWidth)+"px";

                // Centralize the timer on its side of the screen
                timer.style.width = Math.floor(timerLength*timerDivWidthInc)+"px";
                timer.style.height = Math.floor(timerLabel.offsetHeight*timerDivWidthInc)+"px";
                if (left > timerLength) {
                    left = Math.floor((left - timerLength) * 0.5);
                    timer.style.left = left+"px";
                }
                timer.style.top = Math.floor((height*timerDivHeightInc - timer.offsetHeight) * 0.5)+"px";

                // Center the label within its box
                timerLabel.style.left = (timer.offsetLeft + Math.floor((timerLength*timerDivWidthInc - timerLabel.offsetWidth)*0.5))+"px";
                timerLabel.style.top = Math.floor((height*timerDivHeightInc - timer.offsetHeight) * 0.5)+"px";
                timerLine1.style.width = (timer.offsetWidth - 2)+"px";
                timerLine2.style.width = (timer.offsetWidth - 2)+"px";

                // Write the game info into the screen
                gameInfoTxt = "&nbsp game position: {";
                gameInfoTxt += " x: "+gameColorkey.offsetLeft;
                gameInfoTxt += ", y: "+gameColorkey.offsetTop;
                gameInfoTxt += ", w: "+gameColorkey.offsetWidth;
                gameInfoTxt += ", h: "+gameColorkey.offsetHeight;
                gameInfoTxt += " } &nbsp";
                gameInfo.innerHTML = gameInfoTxt;

                // Set the game title and its position
                gameTitle = gameTitle.replace(/%20/g, " ")
                titleLength = getLabelLength(gameTitle);

                titleLabel.innerText = gameTitle;

                title.style.width = Math.floor(titleLength*timerDivWidthInc)+"px";
                title.style.height = Math.floor(titleLabel.offsetHeight*timerDivWidthInc)+"px";
                left = Math.floor((document.body.offsetWidth - titleLength) * 0.5);
                title.style.left = left+"px";
                title.style.top = ((gameView.offsetTop + gameView.offsetHeight)+Math.floor((document.body.offsetHeight - gameView.offsetTop - gameView.offsetHeight) * 0.25))+"px";

                titleLabel.style.left = (title.offsetLeft + Math.floor((titleLength*timerDivWidthInc - titleLabel.offsetWidth)*0.5))+"px";
                titleLabel.style.top = (title.offsetTop + Math.floor((title.offsetHeight - titleLabel.offsetHeight)  * 0.5))+"px";
                titleLine1.style.width = (title.offsetWidth - 2)+"px";
                titleLine2.style.width = (title.offsetWidth - 2)+"px";

                // Place the gamepad (no matter whether visible or not) slightly bellow the timer
                gamepad.style.left = Math.floor((gameView.offsetLeft - gamepad.children[0].offsetWidth) * 0.5)+"px";
                gamepad.style.top = timer.offsetTop + timer.offsetHeight + 8 + "px";
            }
        </script>
    </head>
    <body>
        <div id="timerDiv" class="fixedRoot darkBg">
            <div id="timerLine1" class="fixedChild line" style="left: 1px; top: 2px;"></div>
            <div id="timerLine2" class="fixedChild line" style="left: 1px; bottom: 2px;"></div>
        </div>
        <label id="timer" class="fixedRoot m5x7 outlined centered">0:00:00.000</label>

        <div id="gameView" class="fixedRoot darkBg gameDiv" ></div>
        <div id="gameColorkey" class="fixedRoot gameColorkey" ></div>

        <div id="titleDiv" class="fixedRoot darkBg">
            <div id="titleLine1" class="fixedChild line" style="left: 1px; top: 2px;"></div>
            <div id="titleLine2" class="fixedChild line" style="left: 1px; bottom: 2px;"></div>
        </div>
        <label id="title" class="fixedRoot m5x7 outlined centered">Game title</label>

        <label id="gameInfo" class="fixedRoot m5x7 gameInfo darkBg">&nbsp game div info here &nbsp</label>

        <div class='fixedRoot' id='gamepad-view'>
            <img class='fixedChild' style='width: 220px; left: 0px; top: 0px;' src='/img/skin/small_border.png' />

            <img class='fixedChild' style='width: 190px; left: 18px; top: 18px;' src='/img/gamepad/x360/released_buttons.png' />

            <img id='gamepad_l2' class='fixedChild' style='width: 42px; height: 20px; left: 22px; top: 18px; visibility: hidden;' src='/img/gamepad/x360/pressed/l2.png'/>
            <img id='gamepad_l1' class='fixedChild' style='width: 34px; height: 14px; left: 62px; top: 28px; visibility: hidden;' src='/img/gamepad/x360/pressed/l1.png'/>
            <img id='gamepad_r2' class='fixedChild' style='width: 42px; height: 20px; left: 156px; top: 18px; visibility: hidden;' src='/img/gamepad/x360/pressed/r2.png'/>
            <img id='gamepad_r1' class='fixedChild' style='width: 34px; height: 14px; left: 122px; top: 28px; visibility: hidden;' src='/img/gamepad/x360/pressed/r1.png'/>
            <img id='gamepad_home' class='fixedChild' style='width: 26px; height: 26px; left: 96px; top: 46px; visibility: hidden;' src='/img/gamepad/x360/pressed/home.png'/>
            <img id='gamepad_select' class='fixedChild' style='width: 24px; height: 14px; left: 74px; top: 70px; visibility: hidden;' src='/img/gamepad/x360/pressed/select.png'/>
            <img id='gamepad_start' class='fixedChild' style='width: 24px; height: 14px; left: 120px; top: 70px; visibility: hidden;' src='/img/gamepad/x360/pressed/start.png'/>
            <img id='gamepad_x' class='fixedChild' style='width: 26px; height: 26px; left: 146px; top: 66px; visibility: hidden;' src='/img/gamepad/x360/pressed/x.png'/>
            <img id='gamepad_y' class='fixedChild' style='width: 26px; height: 26px; left: 168px; top: 44px; visibility: hidden;' src='/img/gamepad/x360/pressed/y.png'/>
            <img id='gamepad_a' class='fixedChild' style='width: 26px; height: 26px; left: 160px; top: 92px; visibility: hidden;' src='/img/gamepad/x360/pressed/a.png'/>
            <img id='gamepad_b' class='fixedChild' style='width: 26px; height: 26px; left: 182px; top: 70px; visibility: hidden;' src='/img/gamepad/x360/pressed/b.png'/>
            <img id='gamepad_up' class='fixedChild' style='width: 14px; height: 14px; left: 82px; top: 102px; visibility: hidden;' src='/img/gamepad/x360/pressed/up.png'/>
            <img id='gamepad_down' class='fixedChild' style='width: 14px; height: 14px; left: 82px; top: 126px; visibility: hidden;' src='/img/gamepad/x360/pressed/down.png'/>
            <img id='gamepad_left' class='fixedChild' style='width: 14px; height: 14px; left: 70px; top: 114px; visibility: hidden;' src='/img/gamepad/x360/pressed/left.png'/>
            <img id='gamepad_right' class='fixedChild' style='width: 14px; height: 14px; left: 94px; top: 114px; visibility: hidden;' src='/img/gamepad/x360/pressed/right.png'/>

            <img id='gamepad_lstick' class='fixedChild' style='width: 18px; height: 18px; left: 36px; top: 80px;' src='/img/gamepad/x360/stick.png'/>
            <img id='gamepad_rstick' class='fixedChild' style='width: 18px; height: 18px; left: 126px; top: 112px;' src='/img/gamepad/x360/stick.png'/>
        </div>
    </body>
</html>
